#!/bin/bash

build_dir=$1
cache_dir=$2
if [ -z "$cache_dir" ]; then
  cache_dir="."
fi

mkdir -p "$cache_dir"

if [ -f "$cache_dir/mimetex" ]; then
  echo "Using cached mimetex..."
  mkdir -p "$build_dir/mimetex"
  export PATH="$PATH:$build_path/mimetex/mimetex"
  cp "$cache_dir/mimetex" "$build_dir/mimetex/mimetex"
  exit 0
fi

echo "Downloading mimetex source code..."
wget http://www.forkosh.com/mimetex.zip
echo "Downloaded!"

echo "Unzipping..."
unzip mimetex.zip
echo "Unzipped!"

echo "Compiling..."
gcc -DAA -O2 mimetex.c gifsave.c -lm -o "$cache_dir/mimetex"
echo "Compiled!"

mkdir -p "$build_dir/mimetex"
export PATH="$PATH:$build_path/mimetex/mimetex"
cp "$cache_dir/mimetex" "$build_dir/mimetex/mimetex"
